## Shielded VMとは
- リモート攻撃、権限昇格などから保護する
- セキュアブート：起動時に悪意のあるコードが読み込まれるのを防ぐ機能
  - これはUEFIファームウェアで実現

## 暗号化
- データは保存時に全て暗号化される
- データと共に暗号化に使用するDEK（暗号化された）も保存される
  - DEKはCloudKMSに保存されたKEKで暗号化される
  - DEKはチャンクごとにランダムなアルゴリズムで自動生成される
- 攻撃：トリプルデス
  - 差分攻撃
  - 多くのデータで使用しているとそれらの差分から攻撃してくるもの 
  - 長期間鍵を保存していることで時間により
    - 脆弱性の可能性が増える
- Google対策
  - DEKは50KBのチャンクごとに別の鍵を使う
  - 長期間同じKEKを使わないようにローテーション機能がある
- KEK
  - 標準
    - 90日でローテーション
    - 最大２０バージョン
    - 最低でも５年に１度際暗号化が必要になる  
  - 軍事機密レベルの重要なデータへの対策
    - CMEKを活用する
      - キーの生成
      - ローテーション期間
      - キーの有効期限
    - 最近CMEKを使って暗号化するのを推奨されている
      - KEKの「最低５年に１度は長いな...」と思われる

## gcloud
- プロジェクトIDを取得
`gcloud config get-value project`
- 
`bigquery-qwiklab@$(gcloud config get-value project).iam.gserviceaccount.com`

## ストレージ
![image](https://user-images.githubusercontent.com/45380191/118919221-13d27480-b96f-11eb-87bc-a85c25e29a36.png)
- 権限は上位から継承される
- パーミッション 
  - IAMロール
  - ACL（オブジェクト）
- バケットの監査はデフォルトで有効
  - バケット・オブジェクトの作成や修正などのログ  
- アクセスログはデフォルトは無効なので、有効化する必要がある
  -　オブジェクトを読み込んだログなど詳細な情報を記録
  -　使用方法
    - アクセスログ用のバケットが必要
    - バケットへの書き込み権限が必要
    - 1日1回作成、1時間ごとにログを保存
    ![image](https://user-images.githubusercontent.com/45380191/118919392-5eec8780-b96f-11eb-9229-5ff4ecd03905.png)
  - auditlogでもアクセスログは取得できるが、ここで説明するアクセスログよりものすごく詳細なメタデータを含んだログが記録される
    - 一般的に解析するレベルだと、ストレージのアクセスログを使用することを推奨
- ロードジョブを仕様してBigqueryに保存する
  ![image](https://user-images.githubusercontent.com/45380191/118919493-95c29d80-b96f-11eb-8b76-6617de7fe5a5.png)
- gsutilコマンドで署名付きURLを作成
  ![image](https://user-images.githubusercontent.com/45380191/118919614-cefb0d80-b96f-11eb-8c52-73d7fecac618.png)
  



