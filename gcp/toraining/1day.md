# 設計の基本
1. 運用上のセキュリティ
2. インターネット通信
3. ストレージサービス
4. ユーザのアカウント
5. サービスのデプロイメント
6. ハードウェアのインフラ

## 5. サービスのデプロイメント
- サービスの同一性、完全性、独立性
- 内部でのサービス間通信の暗号化

## 3. ストレージサービス
- 保存時の暗号化
- ハードウェアの追跡と廃棄

## 法令遵守
- GDPR
- PCI-DSS
- HIPAA
- FedRamp

## データアクセス
- 全てRESTAPIで通信を行う

## データ削除
- 物理ではなく論理削除なので、特定のプロセスを経由して復旧した事例もある
- ユーザー削除から180日以内に削除される

### Access Approval API
- グーグルであれ、細かな小人を行わなければデータにアクセスできない
- センシティブなデータを管理する場合有用
#### フィールド
- リソースの場所
- 要求時間
- 許可される期間
- 要求者の物理的な場所
etc
#### 注意
- ログエントリが生成されないイベントは使用できない
- 承認などの手間が挟まるのでサポート時間が長くなる可能性がある

### 
セキュリティに関して
- Google従業員U2Fの認証を必要する 
コンプライアンスについて
- 独立した検証を定期的に受けてる
DoS攻撃
- Google Front End
- 大量の帯域で攻撃を吸収可能


# IAM
## Resource Manager
- フォルダに紐づけられたプロジェクトに権限を付与する
- 従来は紐づけられたプロジェクト配下だったが、tagを使用して適用する対象を制限することもできるようになった
## サービスアカウント
- 鍵の管理方法が２種類
  - google管理サービスアカウント
    - 公開鍵が署名に賞できる期間は二週間 
  - user管理サービスアカウント
    - この鍵はgoogleが保存・管理していないのでダウンロードする機会でしか取得できず復旧不可
    - どこの場所に保存されているか厳密に管理する必要がある
## ロール
- 基本
  - オーナー、編集者、閲覧者、課金管理者
- 事前定義ロール
  - これを主に活用すると良い
  - 誰に、どのようにロールを割り振るのかがセキュリティの上で重要
-  カスタムロール
  - 推奨はできない
  - これを作るのはもの凄く難しい
  - ロールの名前が使う人ベースで権限の内容を認識できるか、認識合わせができるか難しい
  - 許可した権限も今後分割されて二つの権限になる可能性もある（事例あり）
## IAM　Recommender
- IAM権限の見直しをするきっかけになる
- 過去90日に使用された権限をもとに、使用していない権限を出力
- ３つの提案
  - ロールを取り消す、置き換え、パーミッションを追加
## Piolicy Troubleshooter
- 必要なパーミッションを簡単に確認できる
- gcloudコマンドのコンソールから確認するのが楽
## ベストプラクティス
- 必要最低限の権限を付与すること
- グループを使用すること
- Google管理の定義済みロールを活用すること

# 監査ログ
## 管理者の監査ログ
- 常に書き込まれる
- デフォルト：有効（変更不可）
## システム監査ログ
- デフォルト：有効（変更不可）
## データアクセス監査ログ
- デフォルト：無効（変更可）
  - auditlogから変更可
### 注意
- 1G=50円（1TB＝5万）
- GoogleStorageは50GBまで無料、それ以上は課金

#### IAM
- 権限の取り消しは即座ではなく１分など時間がかかる時がある

### workspaceの登録
- https://support.google.com/cloudidentity/answer/7389973?hl=ja
- 組織の管理者数は最低２人必要
- 既存でプロジェクト作成と支払いアカウント作成権限の２つが付与されているので削除したほうがよいと思われる
### SAML
- セキュリティ>SAMLシングルサインオン...>ログインページのURL/ログアウトページのURLなどを入力必要

## VPC
### ファイアウォール
- 接続方法
  - ネットワーク内の全インスタンス
  - ターゲットタグを持つインスタンス
  - 特定のサービスアカウントを使用しているインスタンス
- デフォルトVPC
  - デフォルトで様々な許可する設定などが追加されるので使用が推奨できない
- GREトラフィック: SD-WANの関係、そしてコロナの影響で重要視されるようになった
#### 命名規則（統一したほうがよい）
- {firection}-{allow/deny}-{service}-{to-from-lacation}
#### 組織のファイアウォール
#### マネージドSSLプロファイル
- 互換：win7やガラゲーなどにどうしても対応したい場合など
- モダン
#### VPCピアリング
#### VPN
- 静的
#### Cloud Router
- 動的
- BGPが活用されて、
### ベストプラクティス
- 本番環境でデフォルトVPCを使わない

## ServiceControl
- データの持ち出しを防ぐことも可能

# Flow Logs

### Network Topology
- ネットワークの関係図が見られる


#　余談
- SAML：（読み方）サムエル
