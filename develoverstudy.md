#Lamdba
##イベントソース
ポーリングベース
　ストリーム型：DynamoDB、Kinesis
　それ以外：SQS
それ以外
##呼び出しタイプ
非同期呼び出し：リクエストが正常に受け付けられたか
同期呼び出し：実行完了時にLambdaファンクション内でセットしたものが返ってくる
##リトライ
同期呼び出し：
非同期呼び出し：自動で２回まで遅延を含んでリトライされ、その後破棄
ポーリング（ストリーム）：失敗したら有効期限が切れるか、成功処理するまでそのシャードからの読み込まない
ポーリング（それ以外）：すべてキューに帰りVisibkityTimeoutが過ぎれば処理され成功されたら削除、新しいメッセージはブロックされない
>ユースケース
>Kinesis：順序性の保証
>SQS：リトライ時にブロックされないこと
## 同時実行数
同時実行数までいきなりスパイクすることはない、トラフィックに応じてスケーリングしていく
セーフガード：1000で制限
セーフガードを超えた場合はスロットリングエラー（エラーコード429)
　非同期は15~30分程度はバーストとして許容されるがその後はスロットリング対象
ポーリング（ストリーム）はシャード数と同じ
ポーリング（それ以外）は同時実行数まで自動的にスケールアップ
それ以外は秒間呼び出し回数＊平均実行時間（秒）
##基本
ハンドラー：呼び出しの際にパラメータとして渡されるJSON形式のイベントデータにアクセス可能
コンテキスト：ランタイムに関する情報でハンドラー内部からアクセス可、コンテキストオブジェクトが２つ目のパラメータとしてハンドラー関数に渡される
ロギング：CloudwatchLogsに書き込み、Cloudwatchlogsのスロットリングによって削除される場合がある（実行コンテキスト終了時も可能性有）
例外：言語によって正常酋長や例外通知が異なる
##デプロイパッケージ
chmod a+x：Lambdaが読むのでファイルのパーミッションに読み込み権限が必要
##スロットリング（ボタン）
対象の関数が実行中であろうと全ての処理が停止されエラーが出る
##routing-config
バージョン間でトラフィック量を調整できる（90：10）
##LambdaLayer
ライブラリをLayerとしてアップロードしておくことで、複数の関数で再利用できる
##デッドレターキュー（DLQ)
非同期実行時に2回のリトライにかかわらず正常終了しなかったときはSQSキューかSNSトピックに送信される
メッセージ内容：RequestID（一位のリクエストID)、ErrorCode（HTTPエラーコード）、ErrorMessage（エラーメッセージ）
## X-Rayを使ってLambdaのトラブルシューティング
デプロイパッケージにX-Rayを追加し、アクティブトレースをOnにするのと実行権限追加をすることで使用可能
##CloudTrailで監査的なログを取得
##CloudWatchLogsでデバッグ可能
##コンテナを再利用する
グローバルスコープはコールドスタートでしか実行されない
##冪等性
最低１回の実行を保証している。まれに２回実行されることがあるので、2回実行されても問題ないようにする


#X-Ray
トレースデータを送信、フィルタ、検索するためのAPIセットを提供
SDKを利用せずともX-Rayに直接トレースデータを送信可能
ローデータの習得も可能
##X-Rayデーモン
UDPでX-RaySDKからトラフィックを受信し、未加工のセグメントデータを収集
受信したデータを一定時間バッファした後AWSX-RayAPIに送信する

#SAM
CloudFormationの拡張：リソースタイプ追加 関数、PIA、テーブル


#ElasticBeanstalk
##環境タイプ
###高い可溶性と伸縮自在性を兼ね備えた構成
ウェブサーバー：ELB＋AutoScaling
ワーカー：SQS＋AutoScaling
###シングルインスタンス
EC21台（AutoScalingでMaxとMinが１に設定）
###ワーカー環境
webアプリケーション（sqsd）が動作
定期的なタスク事項（cron.yaml）
##デプロイメントの用語
In Place Deployment(Rolling Deploy)：インスタンスは現行のまま、新しいリビジョンのコードを反映させる
Bule/Green(Red/Black) Deployment：新しいリビジョンコードを新しいインスタンスに反映させインスタンス事入れ替える
##EBのデプロイ方法
###In Place
All at once
Rolling
Rolling with additional batch
###Bule/Green
Rolling with additional batch
Immutable：(URL Swap)による既存環境と新環境の切替、(AmazonRoute53)を利用した既存環境と新環境の切替
##デプロイの設定
###バッチタイプ
一度にデプロイを反映させる台数（バッチ）を決めるかの「割合」か「固定」かを設定
割合（％）：現在起動中のインスタンスの合計に対する割合
固定：決まった台数を絶対値で指定
###バッチサイズ
各バッチにデプロイするインスタンスのバッチタイプに対する数または割合
Rolling with additional batch
##マネージドプラットフォーム更新
メンテナンスウィンドウの指定
更新対象のバージョン（[マイナー＆パッチ]or[パッチ])を指定
更新方法は「Immutable」方式で実施
##環境設定のカスタマイズ
###保存済みの設定（保存された設定）
起動中の環境で使用している環境設定をS3に設定ファイルとして保存
環境作成時や起動中の環境に適用するなど再利用が可能
###.ebextentions
環境に対する自動化＆周釈叶
####ユースケース
カスタム環境変数の指定、ソフトウェアインストール
ソフトウェアの実行、デフォルトにないAWSリソースの作成
####実行可能な操作
packages: yumやrpmを利用したパッケージのインストール
sources: 外部からのアーカイブ(tarなど)をダウンロードして指定した場所に展開
files: 指定した場所にファイルを作成
services: serviceを起動したり、起動設定を変更したりする
users/groups: 任意のユーザー/グループを作成
commands: デプロイ処理前に実行すべきコマンドやスクリプトを指定
例)OSやミドルウェアの設定変更
container_commands:新バージョンの展開後に実行すべきコマンドや
スクリプトを指定
例)アプリ内のリソースや設定の環境に応じた変更など
option_settings: 環境変数の設定
Resources: 追加のリソースを定義
例) SQSのキュー、DynamoDBのテーブル、CloudWatchのアラーム
##モニタリング
###基本ヘルスレポート
環境のヘルスステータス
ELBのヘルスチェック
CloudWatchメトリクス
###拡張ヘルスレポート
OSレベルのメトリクス
アプリケーションレベルのメトリクス
####主なメトリクス
EnvironmentHealth
インスタンスの状態
https://docs.aws.amazon.com/ja_jp/elasticbeanstalk/latest/dg/health-enhanced-cloudwatch.html#health-enhanced-cloudwatch-metrics


#DynamoDB
